tinymce.PluginManager.add("magicline",function(b,a){if(typeof b.settings.valid_classes=="string"){b.settings.valid_classes+=" nomagicline"}else{if(typeof b.settings.valid_classes=="object"){var c=b.settings.valid_classes["*"];b.settings.valid_classes["*"]=(c!=undefined)?c+" nomagicline":"nomagicline"}}b.on("init",function(){var B=b.settings.magicline_color||"#4A8DE0",m=b.settings.magicline_targetedItems||["DIV","IMG"],u=b.settings.magicline_triggerMargin||20,k=b.settings.magicline_insertedBlockTag||"p";var H,i,s,o,h,e,v,w,g,f,q,l,x,E,C,p,n,A,t,j=tinymce.dom.DomQuery,D=b.dom,d=b.$()[0],z=(b.settings.inline===true)?true:false;function y(J,I){h=parseInt(D.getStyle(J,"border-left-width",true));e=parseInt(D.getStyle(J,"border-right-width",true));s=parseInt(D.getStyle(J,"padding-left",true));o=parseInt(D.getStyle(J,"padding-right",true));n=I-u;p=D.getPos(J,d).x;A=D.getSize(J).w;p+=s;A-=s+o;if(C){n-=t}if(J===d){A-=h+e}else{p+=h;A-=h+e;if(C){p-=parseInt(D.getStyle(d,"border-left-width",true))}}}function G(I){H=j(I.target);if(H.hasClass("magicline-container")||H.parent(".magicline-container").length>0){return}l=false;while(H.length>0){if(H[0]==d){break}if(!H.hasClass("nomagicline")&&m.indexOf(H[0].tagName)>-1){l=true;i=H;break}H=H.parent()}if(l){C=(D.getStyle(d,"box-sizing",true)==="border-box")?true:false;t=parseInt(D.getStyle(d,"border-top-width",true));g=D.getPos(H[0],d);f=D.getSize(H[0]);q=I.pageY;if(z){q-=D.getPos(d).y}if(!C){q-=t}if(Math.abs(g.y-q)<=u){v=H.prev();if(v.length==0||v.hasClass("magicline-container")||m.indexOf(v[0].tagName)>-1){x="top";y(H.parent()[0],g.y);D.setStyles(r,{top:n+"px",left:p+"px",width:A+"px"});D.show(r)}return}else{if(Math.abs(g.y+f.h-q)<=u){w=H.next();if(w.length==0||w.hasClass("magicline-container")||m.indexOf(w[0].tagName)>-1){x="bottom";y(H.parent()[0],g.y+f.h);D.setStyles(r,{top:n+"px",left:p+"px",width:A+"px"});D.show(r)}return}}}D.hide(r)}D.setStyle(d,"position","relative");var r=D.create("div",{"class":"magicline-container",style:"width: 100%; position: absolute; display: block; top: 0; left: 0; margin: 0; padding: 0; height: "+u*2+"px;-webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;",contentEditable:"false","data-mce-bogus":"1"});D.add(r,"div",{"class":"magicline-dashedline",style:"position:absolute; top: 50%; left: 0; display: block; border: 0; border-top: 1px dashed "+B+"; height: 0; width: 100%; margin: 0; padding: 0;","data-mce-bogus":"1"});var F=D.add(r,"div",{"class":"magicline-bt_insert",style:'position: absolute; top: 50%; right: 25px; height: 16px; width: 16px; margin: 0; padding: 0; margin-top: -7px;font-size: 0;color: white; background: url("'+a+'/img/icon.png") center no-repeat '+B+";cursor: pointer; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;",title:"Insert paragraph here",contentEditable:"false","data-mce-bogus":"1"});D.add(r,"div",{"class":"magicline-arrow-left",style:"display: block; position: absolute; left: 0; top: 50%; height: 0; width: 0; margin: 0; padding: 0; margin-top: -7px;border: 8px solid transparent; border-left-color: "+B+";",contentEditable:"false","data-mce-bogus":"1"});D.add(r,"div",{"class":"magicline-arrow-right",style:"display: block; position: absolute; right: 0; top: 50%; height: 0; width: 0; margin: 0; padding: 0; margin-top: -7px;border: 8px solid transparent; border-right-color: "+B+";",contentEditable:"false","data-mce-bogus":"1"});D.bind(r,"click",function(I){if(I.target===F){b.focus(false);var J=D.create(k,{},'<br data-mce-bogus="1">');if(x==="top"){i.before(J)}else{i.after(J)}b.selection.select(J,true)}D.hide(r)});D.hide(r);D.add(d,r);b.$().on("mousemove",function(I){clearTimeout(E);E=setTimeout(function(){G(I)},25)})})});